<!DOCTYPE html>
<!-- saved from url=(0057)file:///C:/Users/DELL/Downloads/belajar/single/index.html -->
<html lang="id"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kesepakatan Jual Beli Saham - Negosiasi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5276;
            --primary-light: #2980b9;
            --secondary: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --white: #ffffff;
            --gray: #95a5a6;
            --border: #bdc3c7;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: var(--white);
            margin-bottom: 30px;
            padding: 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: var(--dark);
        }

        .tab-btn {
            flex: 1;
            padding: 18px 20px;
            border: none;
            background: transparent;
            color: var(--gray);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.1);
            color: var(--white);
        }

        .tab-btn.active {
            background: var(--primary);
            color: var(--white);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: var(--warning);
            border-radius: 3px 3px 0 0;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title .icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: var(--white);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .form-section {
            background: linear-gradient(145deg, #f8f9fa, #ffffff);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .form-section h3 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section h3 .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-buyer {
            background: #d4edda;
            color: #155724;
        }

        .badge-seller {
            background: #f8d7da;
            color: #721c24;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group label .required {
            color: var(--danger);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: var(--white);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(26, 82, 118, 0.1);
        }

        .form-control:hover {
            border-color: var(--primary-light);
        }

        select.form-control {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%232c3e50' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }

        .calculated-field {
            background: linear-gradient(145deg, #e8f4f8, #d4edda);
            font-weight: 700;
            color: var(--secondary);
            font-size: 1.1rem;
        }

        /* Stock Autocomplete Styles */
        .stock-input-wrapper {
            position: relative;
        }

        .stock-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 2px solid var(--primary);
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stock-dropdown.show {
            display: block;
        }

        .stock-dropdown-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--light);
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stock-dropdown-item:hover,
        .stock-dropdown-item.selected {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        }

        .stock-dropdown-item:last-child {
            border-bottom: none;
        }

        .stock-code {
            font-weight: 700;
            color: var(--primary);
            font-size: 1rem;
            min-width: 60px;
        }

        .stock-name {
            color: var(--dark);
            font-size: 0.9rem;
            flex: 1;
            margin-left: 15px;
        }

        .stock-sector {
            background: var(--light);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            color: var(--gray);
            margin-left: 10px;
        }

        .no-result {
            padding: 15px;
            text-align: center;
            color: var(--gray);
        }

        /* Stocks Table */
        .stocks-container {
            margin-top: 20px;
        }

        .stocks-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stocks-table th {
            background: var(--primary);
            color: var(--white);
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .stocks-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        .stocks-table tbody tr:hover {
            background: #f8f9fa;
        }

        .stocks-table .form-control {
            padding: 10px 12px;
            font-size: 0.9rem;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(26, 82, 118, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: var(--white);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
            color: var(--white);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #d35400, #e67e22);
            color: var(--white);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
            color: var(--white);
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed var(--border);
        }

        /* Preview Section */
        .preview-container {
            background: var(--white);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .preview-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px double var(--primary);
        }

        .preview-header h2 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .preview-header p {
            color: var(--gray);
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }

        .preview-section {
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .preview-section.buyer {
            background: linear-gradient(145deg, #d4edda, #e8f5e9);
            border-color: #27ae60;
        }

        .preview-section.seller {
            background: linear-gradient(145deg, #f8d7da, #ffebee);
            border-color: #e74c3c;
        }

        .preview-section h4 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed var(--border);
        }

        .preview-item:last-child {
            border-bottom: none;
        }

        .preview-item .label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .preview-item .value {
            font-weight: 600;
            color: var(--dark);
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .preview-table th {
            background: var(--primary);
            color: var(--white);
            padding: 12px;
            text-align: left;
        }

        .preview-table td {
            padding: 12px;
            border: 1px solid var(--border);
        }

        .preview-table tfoot {
            background: linear-gradient(145deg, #fff3cd, #ffeeba);
            font-weight: 700;
        }

        .preview-table tfoot td {
            font-size: 1.1rem;
        }

        .total-box {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }

        .total-box h3 {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .total-box .amount {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .signature-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 50px;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid var(--border);
        }

        .signature-box {
            text-align: center;
        }

        .signature-box h5 {
            color: var(--dark);
            margin-bottom: 80px;
        }

        .signature-line {
            border-top: 2px solid var(--dark);
            padding-top: 10px;
            font-weight: 600;
        }

        /* History Tab */
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th {
            background: var(--primary);
            color: var(--white);
            padding: 15px;
            text-align: left;
        }

        .history-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .history-table tbody tr:hover {
            background: #f8f9fa;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px 30px;
            background: var(--primary);
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .modal-close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            padding: 20px 30px;
            background: var(--light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1 1 50%;
                padding: 12px;
                font-size: 0.85rem;
            }

            .form-grid, .preview-grid, .signature-section {
                grid-template-columns: 1fr;
            }

            .stocks-table {
                font-size: 0.8rem;
            }

            .stocks-table th, .stocks-table td {
                padding: 8px 5px;
            }

            .preview-container {
                padding: 20px;
            }

            .total-box .amount {
                font-size: 1.8rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .main-card {
                box-shadow: none;
            }

            .tabs, .action-buttons, .btn {
                display: none !important;
            }

            .tab-content {
                display: block !important;
            }

            .preview-container {
                box-shadow: none;
                padding: 20px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark);
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        /* Transaction Type Cards */
        .type-cards {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .type-card {
            flex: 1;
            padding: 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .type-card:hover {
            border-color: var(--primary);
            background: rgba(26, 82, 118, 0.05);
        }

        .type-card.selected {
            border-color: var(--primary);
            background: rgba(26, 82, 118, 0.1);
        }

        .type-card h4 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .type-card p {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(145deg, #e3f2fd, #bbdefb);
            border-left: 4px solid #2196f3;
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #1565c0;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box p {
            color: #1976d2;
            font-size: 0.9rem;
        }

        /* Stock Search Help */
        .stock-help {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 5px;
            font-style: italic;
        }

        .highlight {
            background: #fff59d;
            padding: 0 2px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üìà Kesepakatan Jual Beli Saham</h1>
            <p>Sistem Pencatatan Transaksi Negosiasi Saham</p>
        </header>

        <div class="main-card">
            <div class="tabs">
                <button class="tab-btn" data-tab="input">
                    üìù Input Transaksi
                </button>
                <button class="tab-btn" data-tab="preview">
                    üëÅÔ∏è Preview Dokumen
                </button>
                <button class="tab-btn active" data-tab="history">
                    üìã Riwayat Transaksi
                </button>
            </div>

            <!-- Input Tab -->
            <div class="tab-content" id="input">
                <div class="info-box">
                    <h4>‚ÑπÔ∏è Informasi</h4>
                    <p>Lengkapi semua data di bawah ini untuk membuat kesepakatan jual beli saham negosiasi. Ketik kode saham untuk mencari otomatis.</p>
                </div>

                <div id="alertContainer"></div>

                <form id="transactionForm">
                    <!-- Buyer & Seller Section -->
                    <div class="section-title">
                        <span class="icon">üë•</span>
                        Data Pihak Transaksi
                    </div>

                    <div class="form-grid">
                        <!-- Buyer Section -->
                        <div class="form-section">
                            <h3>
                                <span class="badge badge-buyer">PEMBELI</span>
                                Data Pembeli
                            </h3>
                            
                            <div class="form-group">
                                <label>Client ID <span class="required">*</span></label>
                                <input type="text" class="form-control" id="buyerClientId" placeholder="Contoh: CLI-001" required="">
                            </div>

                            <div class="form-group">
                                <label>Nama Lengkap <span class="required">*</span></label>
                                <input type="text" class="form-control" id="buyerName" placeholder="Nama lengkap pembeli" required="">
                            </div>

                            <div class="form-group">
                                <label>Nama Broker <span class="required">*</span></label>
                                <select class="form-control" id="buyerBroker" required="">
                                    <option value="">-- Pilih Broker --</option>
                                    <option value="Mandiri Sekuritas">Mandiri Sekuritas (CC)</option>
                                    <option value="BCA Sekuritas">BCA Sekuritas (EP)</option>
                                    <option value="Indo Premier Sekuritas">Indo Premier Sekuritas (PD)</option>
                                    <option value="Mirae Asset Sekuritas">Mirae Asset Sekuritas (YP)</option>
                                    <option value="CGS-CIMB Sekuritas">CGS-CIMB Sekuritas (YU)</option>
                                    <option value="Phillip Sekuritas">Phillip Sekuritas (KK)</option>
                                    <option value="Sinarmas Sekuritas">Sinarmas Sekuritas (DH)</option>
                                    <option value="BNI Sekuritas">BNI Sekuritas (NI)</option>
                                    <option value="Trimegah Sekuritas">Trimegah Sekuritas (LG)</option>
                                    <option value="Panin Sekuritas">Panin Sekuritas (GR)</option>
                                    <option value="Maybank Sekuritas">Maybank Sekuritas (ZP)</option>
                                    <option value="Samsung Sekuritas">Samsung Sekuritas (IF)</option>
                                    <option value="Sucor Sekuritas">Sucor Sekuritas (SZ)</option>
                                    <option value="RHB Sekuritas">RHB Sekuritas (DR)</option>
                                    <option value="Ajaib Sekuritas">Ajaib Sekuritas (AK)</option>
                                    <option value="Stockbit Sekuritas">Stockbit Sekuritas (MG)</option>
                                    <option value="other">Lainnya...</option>
                                </select>
                            </div>

                            <div class="form-group" id="buyerBrokerOtherGroup" style="display: none;">
                                <label>Nama Broker (Lainnya)</label>
                                <input type="text" class="form-control" id="buyerBrokerOther" placeholder="Masukkan nama broker">
                            </div>
                        </div>

                        <!-- Seller Section -->
                        <div class="form-section">
                            <h3>
                                <span class="badge badge-seller">PENJUAL</span>
                                Data Penjual
                            </h3>
                            
                            <div class="form-group">
                                <label>Client ID <span class="required">*</span></label>
                                <input type="text" class="form-control" id="sellerClientId" placeholder="Contoh: CLI-002" required="">
                            </div>

                            <div class="form-group">
                                <label>Nama Lengkap <span class="required">*</span></label>
                                <input type="text" class="form-control" id="sellerName" placeholder="Nama lengkap penjual" required="">
                            </div>

                            <div class="form-group">
                                <label>Nama Broker <span class="required">*</span></label>
                                <select class="form-control" id="sellerBroker" required="">
                                    <option value="">-- Pilih Broker --</option>
                                    <option value="Mandiri Sekuritas">Mandiri Sekuritas (CC)</option>
                                    <option value="BCA Sekuritas">BCA Sekuritas (EP)</option>
                                    <option value="Indo Premier Sekuritas">Indo Premier Sekuritas (PD)</option>
                                    <option value="Mirae Asset Sekuritas">Mirae Asset Sekuritas (YP)</option>
                                    <option value="CGS-CIMB Sekuritas">CGS-CIMB Sekuritas (YU)</option>
                                    <option value="Phillip Sekuritas">Phillip Sekuritas (KK)</option>
                                    <option value="Sinarmas Sekuritas">Sinarmas Sekuritas (DH)</option>
                                    <option value="BNI Sekuritas">BNI Sekuritas (NI)</option>
                                    <option value="Trimegah Sekuritas">Trimegah Sekuritas (LG)</option>
                                    <option value="Panin Sekuritas">Panin Sekuritas (GR)</option>
                                    <option value="Maybank Sekuritas">Maybank Sekuritas (ZP)</option>
                                    <option value="Samsung Sekuritas">Samsung Sekuritas (IF)</option>
                                    <option value="Sucor Sekuritas">Sucor Sekuritas (SZ)</option>
                                    <option value="RHB Sekuritas">RHB Sekuritas (DR)</option>
                                    <option value="Ajaib Sekuritas">Ajaib Sekuritas (AK)</option>
                                    <option value="Stockbit Sekuritas">Stockbit Sekuritas (MG)</option>
                                    <option value="other">Lainnya...</option>
                                </select>
                            </div>

                            <div class="form-group" id="sellerBrokerOtherGroup" style="display: none;">
                                <label>Nama Broker (Lainnya)</label>
                                <input type="text" class="form-control" id="sellerBrokerOther" placeholder="Masukkan nama broker">
                            </div>
                        </div>
                    </div>

                    <!-- Transaction Section -->
                    <div class="section-title" style="margin-top: 40px;">
                        <span class="icon">üìä</span>
                        Data Transaksi
                    </div>

                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Tanggal Transaksi <span class="required">*</span></label>
                                <input type="date" class="form-control" id="transactionDate" required="">
                            </div>

                            <div class="form-group">
                                <label>No. Referensi</label>
                                <input type="text" class="form-control" id="referenceNo" placeholder="Auto-generate" readonly="">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Tipe Transaksi <span class="required">*</span></label>
                            <div class="type-cards">
                                <div class="type-card selected" data-type="DVP" onclick="selectTransactionType(&#39;DVP&#39;)">
                                    <h4>DVP</h4>
                                    <p>Delivery Versus Payment</p>
                                </div>
                                <div class="type-card" data-type="FOP" onclick="selectTransactionType(&#39;FOP&#39;)">
                                    <h4>FOP</h4>
                                    <p>Free of Payment</p>
                                </div>
                            </div>
                            <input type="hidden" id="transactionType" value="DVP">
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Settlement Date <span class="required">*</span></label>
                                <select class="form-control" id="settleType" required="">
                                    <option value="">-- Pilih Settlement --</option>
                                    <option value="T+0">T+0 (Same Day)</option>
                                    <option value="T+1">T+1 (Next Day)</option>
                                    <option value="T+2">T+2 (Standard)</option>
                                    <option value="T+3">T+3</option>
                                    <option value="T+4">T+4</option>
                                    <option value="T+5">T+5</option>
                                    <option value="T+7">T+7</option>
                                    <option value="custom">Lainnya (Custom)</option>
                                </select>
                            </div>

                            <div class="form-group" id="customSettleGroup" style="display: none;">
                                <label>Custom Settlement</label>
                                <input type="text" class="form-control" id="customSettle" placeholder="Contoh: T+10">
                            </div>

                            <div class="form-group">
                                <label>Tanggal Settlement</label>
                                <input type="date" class="form-control" id="settleDate" readonly="">
                            </div>
                        </div>
                    </div>

                    <!-- Stocks Section -->
                    <div class="section-title" style="margin-top: 40px;">
                        <span class="icon">üìà</span>
                        Data Saham
                    </div>

                    <div class="form-section stocks-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                            <h3 style="margin: 0;">Daftar Saham</h3>
                            <div style="display: flex; gap: 10px;">
                                <button type="button" class="btn btn-success btn-sm" onclick="addStockRow()">
                                    ‚ûï Tambah Saham
                                </button>
                            </div>
                        </div>

                        <p class="stock-help">üí° Ketik kode atau nama saham untuk mencari. Data akan terisi otomatis.</p>

                        <div style="overflow-x: auto;">
                            <table class="stocks-table" id="stocksTable">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">No</th>
                                        <th style="width: 150px;">Kode Saham</th>
                                        <th style="width: 220px;">Nama Saham</th>
                                        <th style="width: 130px;">Jumlah (Lembar)</th>
                                        <th style="width: 150px;">Harga/Lembar (Rp)</th>
                                        <th style="width: 180px;">Nilai Transaksi (Rp)</th>
                                        <th style="width: 60px;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="stocksBody"><tr id="stockRow1">
                <td>1</td>
                <td>
                    
                <div class="stock-input-wrapper">
                    <input type="text" class="form-control stock-code-input" id="stockCode1" name="stockCode1" placeholder="Ketik kode..." autocomplete="off" oninput="handleStockSearch(1, this.value)" onfocus="handleStockFocus(1)" required="">
                    <div class="stock-dropdown" id="stockDropdown1">
                        <!-- Dropdown items will be populated here -->
                    </div>
                </div>
            
                </td>
                <td>
                    <input type="text" class="form-control" name="stockName1" placeholder="Nama saham (auto)" readonly="" required="" style="background: #f8f9fa;">
                </td>
                <td>
                    <input type="number" class="form-control" name="stockQty1" placeholder="1000" min="1" required="" onchange="calculateRowTotal(1)" oninput="calculateRowTotal(1)">
                </td>
                <td>
                    <input type="number" class="form-control" name="stockPrice1" placeholder="9500" min="1" required="" onchange="calculateRowTotal(1)" oninput="calculateRowTotal(1)">
                </td>
                <td>
                    <input type="text" class="form-control calculated-field" name="stockTotal1" value="Rp 0" readonly="">
                </td>
                <td>
                    <button type="button" class="btn btn-danger btn-icon" onclick="removeStockRow(1)" disabled="" title="Hapus">
                        üóëÔ∏è
                    </button>
                </td>
            </tr></tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="5" style="text-align: right; font-weight: 700;">TOTAL NILAI TRANSAKSI:</td>
                                        <td colspan="2">
                                            <input type="text" class="form-control calculated-field" id="grandTotal" value="Rp 0" readonly="">
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">
                            üîÑ Reset Form
                        </button>
                        <button type="button" class="btn btn-primary" onclick="previewDocument()">
                            üëÅÔ∏è Preview Dokumen
                        </button>
                        <button type="submit" class="btn btn-success">
                            üíæ Simpan Transaksi
                        </button>
                    </div>
                </form>
            </div>

            <!-- Preview Tab -->
            <div class="tab-content" id="preview">
                <div class="preview-container" id="previewContent">
                    <div class="preview-header">
                        <h2>KESEPAKATAN JUAL BELI SAHAM NEGOSIASI</h2>
                        <p>Nomor: <span id="previewRefNo">NEG-20251217-4780</span></p>
                        <p>Tanggal: <span id="previewDate">Selasa, 16 Desember 2025</span></p>
                    </div>

                    <div class="preview-grid">
                        <div class="preview-section buyer">
                            <h4>üõí PIHAK PEMBELI</h4>
                            <div class="preview-item">
                                <span class="label">Client ID</span>
                                <span class="value" id="previewBuyerId">RJGL0001</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Nama Lengkap</span>
                                <span class="value" id="previewBuyerName">NOMI</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Broker</span>
                                <span class="value" id="previewBuyerBroker">Trimegah Sekuritas</span>
                            </div>
                        </div>

                        <div class="preview-section seller">
                            <h4>üí∞ PIHAK PENJUAL</h4>
                            <div class="preview-item">
                                <span class="label">Client ID</span>
                                <span class="value" id="previewSellerId">RJKL456</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Nama Lengkap</span>
                                <span class="value" id="previewSellerName">NAMU</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Broker</span>
                                <span class="value" id="previewSellerBroker">Panin Sekuritas</span>
                            </div>
                        </div>
                    </div>

                    <div class="preview-section" style="background: linear-gradient(145deg, #fff3cd, #ffeeba); margin-bottom: 20px;">
                        <h4>üìä DETAIL TRANSAKSI</h4>
                        <div class="preview-grid" style="gap: 20px;">
                            <div class="preview-item">
                                <span class="label">Tanggal Transaksi</span>
                                <span class="value" id="previewTransDate">Selasa, 16 Desember 2025</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Tipe Transaksi</span>
                                <span class="value" id="previewTransType">FOP</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Settlement</span>
                                <span class="value" id="previewSettleType">T+2</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Tanggal Settlement</span>
                                <span class="value" id="previewSettleDate">Kamis, 18 Desember 2025</span>
                            </div>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px;">üìà DAFTAR SAHAM</h4>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Kode Saham</th>
                                <th>Nama Saham</th>
                                <th>Jumlah (Lembar)</th>
                                <th>Harga/Lembar</th>
                                <th>Nilai Transaksi</th>
                            </tr>
                        </thead>
                        <tbody id="previewStocksBody"><tr>
                    <td>1</td>
                    <td><strong>BBRI</strong></td>
                    <td>Bank Rakyat Indonesia Tbk</td>
                    <td>8.000</td>
                    <td>Rp 9.500</td>
                    <td><strong>Rp 76.000.000</strong></td>
                </tr></tbody>
                        <tfoot>
                            <tr>
                                <td colspan="5" style="text-align: right;">TOTAL NILAI TRANSAKSI</td>
                                <td id="previewTotal">Rp 76.000.000</td>
                            </tr>
                        </tfoot>
                    </table>

                    <div class="total-box">
                        <h3>TOTAL NILAI KESEPAKATAN</h3>
                        <div class="amount" id="previewTotalBig">Rp 76.000.000</div>
                    </div>

                    <div class="signature-section">
                        <div class="signature-box">
                            <h5>PIHAK PEMBELI</h5>
                            <div class="signature-line" id="signBuyerName">NOMI</div>
                        </div>
                        <div class="signature-box">
                            <h5>PIHAK PENJUAL</h5>
                            <div class="signature-line" id="signSellerName">NAMU</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="switchTab(&#39;input&#39;)">
                        ‚Üê Kembali ke Input
                    </button>
                    <button class="btn btn-warning" onclick="printDocument()">
                        üñ®Ô∏è Cetak Dokumen
                    </button>
                    <button class="btn btn-primary" onclick="exportPDF()">
                        üìÑ Export PDF
                    </button>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content active" id="history">
                <div class="section-title">
                    <span class="icon">üìã</span>
                    Riwayat Transaksi
                </div>

                <div style="margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap;">
                    <input type="text" class="form-control" id="searchHistory" placeholder="üîç Cari transaksi..." style="max-width: 300px;">
                    <select class="form-control" id="filterStatus" style="max-width: 200px;">
                        <option value="">Semua Status</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <button class="btn btn-danger btn-sm" onclick="clearAllHistory()">
                        üóëÔ∏è Hapus Semua
                    </button>
                </div>

                <div id="historyContainer">
                    <div class="empty-state" id="emptyHistory" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3>Belum Ada Transaksi</h3>
                        <p>Transaksi yang telah disimpan akan muncul di sini</p>
                    </div>

                    <div style="overflow-x: auto;">
                        <table class="history-table" id="historyTable" style="display: table;">
                            <thead>
                                <tr>
                                    <th>No. Referensi</th>
                                    <th>Tanggal</th>
                                    <th>Pembeli</th>
                                    <th>Penjual</th>
                                    <th>Total Nilai</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="historyBody"><tr>
                    <td><strong>NEG-20251217-4780</strong></td>
                    <td>Selasa, 16 Desember 2025</td>
                    <td>NOMI<br><small style="color: #666">Trimegah Sekuritas</small></td>
                    <td>NAMU<br><small style="color: #666">Panin Sekuritas</small></td>
                    <td><strong>Rp 76.000.000</strong></td>
                    <td>
                        <select class="form-control" style="padding: 5px 10px; font-size: 0.85rem;" onchange="updateStatus(1765926789605, this.value)">
                            <option value="pending" selected="">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="viewDetail(1765926789605)" style="margin-bottom: 5px;">
                            üëÅÔ∏è
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTransaction(1765926789605)">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h3>üìÑ Detail Transaksi</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- Modal content will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Tutup</button>
                <button class="btn btn-primary" onclick="printModalContent()">üñ®Ô∏è Cetak</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== STOCK DATABASE ====================
        const stockDatabase = [
            // LQ45 & Blue Chips
            { code: "BBCA", name: "Bank Central Asia Tbk", sector: "Banking" },
            { code: "BBRI", name: "Bank Rakyat Indonesia Tbk", sector: "Banking" },
            { code: "BMRI", name: "Bank Mandiri Tbk", sector: "Banking" },
            { code: "BBNI", name: "Bank Negara Indonesia Tbk", sector: "Banking" },
            { code: "BRIS", name: "Bank Syariah Indonesia Tbk", sector: "Banking" },
            { code: "BTPS", name: "Bank BTPN Syariah Tbk", sector: "Banking" },
            { code: "BNGA", name: "Bank CIMB Niaga Tbk", sector: "Banking" },
            { code: "BDMN", name: "Bank Danamon Indonesia Tbk", sector: "Banking" },
            { code: "BNII", name: "Bank Maybank Indonesia Tbk", sector: "Banking" },
            { code: "BJBR", name: "Bank Pembangunan Daerah Jawa Barat Tbk", sector: "Banking" },
            { code: "BJTM", name: "Bank Pembangunan Daerah Jawa Timur Tbk", sector: "Banking" },
            { code: "NISP", name: "Bank OCBC NISP Tbk", sector: "Banking" },
            { code: "MEGA", name: "Bank Mega Tbk", sector: "Banking" },
            { code: "ARTO", name: "Bank Jago Tbk", sector: "Banking" },
            { code: "BBYB", name: "Bank Neo Commerce Tbk", sector: "Banking" },
            
            // Telekomunikasi
            { code: "TLKM", name: "Telkom Indonesia Tbk", sector: "Telecom" },
            { code: "EXCL", name: "XL Axiata Tbk", sector: "Telecom" },
            { code: "ISAT", name: "Indosat Ooredoo Hutchison Tbk", sector: "Telecom" },
            { code: "FREN", name: "Smartfren Telecom Tbk", sector: "Telecom" },
            { code: "TOWR", name: "Sarana Menara Nusantara Tbk", sector: "Telecom" },
            { code: "TBIG", name: "Tower Bersama Infrastructure Tbk", sector: "Telecom" },
            { code: "MTEL", name: "Dayamitra Telekomunikasi Tbk", sector: "Telecom" },
            
            // Consumer Goods
            { code: "UNVR", name: "Unilever Indonesia Tbk", sector: "Consumer" },
            { code: "ICBP", name: "Indofood CBP Sukses Makmur Tbk", sector: "Consumer" },
            { code: "INDF", name: "Indofood Sukses Makmur Tbk", sector: "Consumer" },
            { code: "MYOR", name: "Mayora Indah Tbk", sector: "Consumer" },
            { code: "KLBF", name: "Kalbe Farma Tbk", sector: "Consumer" },
            { code: "SIDO", name: "Industri Jamu dan Farmasi Sido Muncul Tbk", sector: "Consumer" },
            { code: "GGRM", name: "Gudang Garam Tbk", sector: "Consumer" },
            { code: "HMSP", name: "H.M. Sampoerna Tbk", sector: "Consumer" },
            { code: "ULTJ", name: "Ultra Jaya Milk Industry Tbk", sector: "Consumer" },
            { code: "CPIN", name: "Charoen Pokphand Indonesia Tbk", sector: "Consumer" },
            { code: "JPFA", name: "Japfa Comfeed Indonesia Tbk", sector: "Consumer" },
            { code: "GOOD", name: "Garudafood Putra Putri Jaya Tbk", sector: "Consumer" },
            { code: "MLBI", name: "Multi Bintang Indonesia Tbk", sector: "Consumer" },
            { code: "DVLA", name: "Darya-Varia Laboratoria Tbk", sector: "Consumer" },
            { code: "TSPC", name: "Tempo Scan Pacific Tbk", sector: "Consumer" },
            
            // Mining & Energy
            { code: "ADRO", name: "Adaro Energy Indonesia Tbk", sector: "Mining" },
            { code: "PTBA", name: "Bukit Asam Tbk", sector: "Mining" },
            { code: "ITMG", name: "Indo Tambangraya Megah Tbk", sector: "Mining" },
            { code: "INCO", name: "Vale Indonesia Tbk", sector: "Mining" },
            { code: "ANTM", name: "Aneka Tambang Tbk", sector: "Mining" },
            { code: "TINS", name: "Timah Tbk", sector: "Mining" },
            { code: "MEDC", name: "Medco Energi Internasional Tbk", sector: "Mining" },
            { code: "HRUM", name: "Harum Energy Tbk", sector: "Mining" },
            { code: "BUMI", name: "Bumi Resources Tbk", sector: "Mining" },
            { code: "DSSA", name: "Dian Swastatika Sentosa Tbk", sector: "Mining" },
            { code: "ESSA", name: "Surya Esa Perkasa Tbk", sector: "Mining" },
            { code: "MBAP", name: "Mitrabara Adiperdana Tbk", sector: "Mining" },
            { code: "GEMS", name: "Golden Energy Mines Tbk", sector: "Mining" },
            { code: "MDKA", name: "Merdeka Copper Gold Tbk", sector: "Mining" },
            { code: "BRMS", name: "Bumi Resources Minerals Tbk", sector: "Mining" },
            { code: "PSAB", name: "J Resources Asia Pasifik Tbk", sector: "Mining" },
            
            // Property & Construction
            { code: "SMGR", name: "Semen Indonesia Tbk", sector: "Construction" },
            { code: "INTP", name: "Indocement Tunggal Prakarsa Tbk", sector: "Construction" },
            { code: "WIKA", name: "Wijaya Karya Tbk", sector: "Construction" },
            { code: "WSKT", name: "Waskita Karya Tbk", sector: "Construction" },
            { code: "PTPP", name: "PP (Persero) Tbk", sector: "Construction" },
            { code: "ADHI", name: "Adhi Karya Tbk", sector: "Construction" },
            { code: "BSDE", name: "Bumi Serpong Damai Tbk", sector: "Property" },
            { code: "CTRA", name: "Ciputra Development Tbk", sector: "Property" },
            { code: "SMRA", name: "Summarecon Agung Tbk", sector: "Property" },
            { code: "PWON", name: "Pakuwon Jati Tbk", sector: "Property" },
            { code: "ASRI", name: "Alam Sutera Realty Tbk", sector: "Property" },
            { code: "LPKR", name: "Lippo Karawaci Tbk", sector: "Property" },
            { code: "JRPT", name: "Jaya Real Property Tbk", sector: "Property" },
            { code: "DMAS", name: "Puradelta Lestari Tbk", sector: "Property" },
            
            // Automotive
            { code: "ASII", name: "Astra International Tbk", sector: "Automotive" },
            { code: "AUTO", name: "Astra Otoparts Tbk", sector: "Automotive" },
            { code: "GJTL", name: "Gajah Tunggal Tbk", sector: "Automotive" },
            { code: "SMSM", name: "Selamat Sempurna Tbk", sector: "Automotive" },
            { code: "IMAS", name: "Indomobil Sukses Internasional Tbk", sector: "Automotive" },
            
            // Retail & Trading
            { code: "ACES", name: "Ace Hardware Indonesia Tbk", sector: "Retail" },
            { code: "AMRT", name: "Sumber Alfaria Trijaya Tbk", sector: "Retail" },
            { code: "LPPF", name: "Matahari Department Store Tbk", sector: "Retail" },
            { code: "MAPI", name: "Mitra Adiperkasa Tbk", sector: "Retail" },
            { code: "ERAA", name: "Erajaya Swasembada Tbk", sector: "Retail" },
            { code: "RALS", name: "Ramayana Lestari Sentosa Tbk", sector: "Retail" },
            { code: "HERO", name: "Hero Supermarket Tbk", sector: "Retail" },
            { code: "RANC", name: "Supra Boga Lestari Tbk", sector: "Retail" },
            
            // Technology
            { code: "GOTO", name: "GoTo Gojek Tokopedia Tbk", sector: "Technology" },
            { code: "BUKA", name: "Bukalapak.com Tbk", sector: "Technology" },
            { code: "EMTK", name: "Elang Mahkota Teknologi Tbk", sector: "Technology" },
            { code: "DCII", name: "DCI Indonesia Tbk", sector: "Technology" },
            
            // Healthcare
            { code: "HEAL", name: "Medikaloka Hermina Tbk", sector: "Healthcare" },
            { code: "MIKA", name: "Mitra Keluarga Karyasehat Tbk", sector: "Healthcare" },
            { code: "SILO", name: "Siloam International Hospitals Tbk", sector: "Healthcare" },
            { code: "PRDA", name: "Prodia Widyahusada Tbk", sector: "Healthcare" },
            
            // Plantation
            { code: "AALI", name: "Astra Agro Lestari Tbk", sector: "Plantation" },
            { code: "LSIP", name: "PP London Sumatra Indonesia Tbk", sector: "Plantation" },
            { code: "SIMP", name: "Salim Ivomas Pratama Tbk", sector: "Plantation" },
            { code: "SSMS", name: "Sawit Sumbermas Sarana Tbk", sector: "Plantation" },
            { code: "SGRO", name: "Sampoerna Agro Tbk", sector: "Plantation" },
            { code: "DSNG", name: "Dharma Satya Nusantara Tbk", sector: "Plantation" },
            
            // Finance & Insurance
            { code: "ADMF", name: "Adira Dinamika Multi Finance Tbk", sector: "Finance" },
            { code: "BFIN", name: "BFI Finance Indonesia Tbk", sector: "Finance" },
            { code: "WOMF", name: "Wahana Ottomitra Multiartha Tbk", sector: "Finance" },
            { code: "CFIN", name: "Clipan Finance Indonesia Tbk", sector: "Finance" },
            { code: "PNLF", name: "Panin Financial Tbk", sector: "Finance" },
            { code: "LPGI", name: "Lippo General Insurance Tbk", sector: "Insurance" },
            { code: "ASRM", name: "Asuransi Ramayana Tbk", sector: "Insurance" },
            
            // Media & Entertainment
            { code: "SCMA", name: "Surya Citra Media Tbk", sector: "Media" },
            { code: "MNCN", name: "Media Nusantara Citra Tbk", sector: "Media" },
            { code: "VIVA", name: "Visi Media Asia Tbk", sector: "Media" },
            { code: "KPIG", name: "MNC Land Tbk", sector: "Media" },
            
            // Industrial
            { code: "UNTR", name: "United Tractors Tbk", sector: "Industrial" },
            { code: "INKP", name: "Indah Kiat Pulp & Paper Tbk", sector: "Industrial" },
            { code: "TKIM", name: "Pabrik Kertas Tjiwi Kimia Tbk", sector: "Industrial" },
            { code: "BRPT", name: "Barito Pacific Tbk", sector: "Industrial" },
            { code: "TPIA", name: "Chandra Asri Petrochemical Tbk", sector: "Industrial" },
            { code: "SRIL", name: "Sri Rejeki Isman Tbk", sector: "Industrial" },
            { code: "JPRS", name: "Jaya Pari Steel Tbk", sector: "Industrial" },
            { code: "ISSP", name: "Steel Pipe Industry of Indonesia Tbk", sector: "Industrial" },
            
            // Transportation
            { code: "GIAA", name: "Garuda Indonesia Tbk", sector: "Transportation" },
            { code: "JSMR", name: "Jasa Marga Tbk", sector: "Transportation" },
            { code: "BIRD", name: "Blue Bird Tbk", sector: "Transportation" },
            { code: "ASSA", name: "Adi Sarana Armada Tbk", sector: "Transportation" },
            { code: "SMDR", name: "Samudera Indonesia Tbk", sector: "Transportation" },
            { code: "TMAS", name: "Pelayaran Tempuran Emas Tbk", sector: "Transportation" },
            { code: "TAXI", name: "Express Transindo Utama Tbk", sector: "Transportation" },
            
            // Utilities
            { code: "PGAS", name: "Perusahaan Gas Negara Tbk", sector: "Utilities" },
            { code: "AKRA", name: "AKR Corporindo Tbk", sector: "Utilities" },
            { code: "POWR", name: "Cikarang Listrindo Tbk", sector: "Utilities" },
            { code: "RAJA", name: "Rukun Raharja Tbk", sector: "Utilities" },
            
            // Food & Beverage
            { code: "ADES", name: "Akasha Wira International Tbk", sector: "F&B" },
            { code: "ALTO", name: "Tri Banyan Tirta Tbk", sector: "F&B" },
            { code: "CEKA", name: "Wilmar Cahaya Indonesia Tbk", sector: "F&B" },
            { code: "DLTA", name: "Delta Djakarta Tbk", sector: "F&B" },
            { code: "HOKI", name: "Buyung Poetra Sembada Tbk", sector: "F&B" },
            { code: "ROTI", name: "Nippon Indosari Corpindo Tbk", sector: "F&B" },
            { code: "STTP", name: "Siantar Top Tbk", sector: "F&B" },
            { code: "CAMP", name: "Campina Ice Cream Industry Tbk", sector: "F&B" },
            
            // BUMN (State-Owned)
            { code: "PGEO", name: "Pertamina Geothermal Energy Tbk", sector: "Energy" },
            { code: "ELSA", name: "Elnusa Tbk", sector: "Energy" },
            { code: "PNBN", name: "Bank Pan Indonesia Tbk", sector: "Banking" },
            { code: "KAEF", name: "Kimia Farma Tbk", sector: "Pharma" },
            { code: "INAF", name: "Indofarma Tbk", sector: "Pharma" },
            { code: "KRAS", name: "Krakatau Steel Tbk", sector: "Industrial" },
            { code: "SMBR", name: "Semen Baturaja Tbk", sector: "Construction" },
            
            // Sharia Stocks
            { code: "TLKM", name: "Telkom Indonesia Tbk", sector: "Sharia" },
            { code: "UNVR", name: "Unilever Indonesia Tbk", sector: "Sharia" }
        ];

        // Remove duplicates based on code
        const uniqueStockDatabase = stockDatabase.filter((stock, index, self) =>
            index === self.findIndex((s) => s.code === stock.code)
        );

        // ==================== INITIALIZATION ====================
        let stockRowCount = 0;
        let transactions = JSON.parse(localStorage.getItem('stockTransactions')) || [];
        let activeDropdown = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            document.getElementById('transactionDate').valueAsDate = new Date();
            generateReferenceNo();
            addStockRow();
            loadHistory();
            setupEventListeners();

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.stock-input-wrapper')) {
                    closeAllDropdowns();
                }
            });
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Broker other field toggle
            document.getElementById('buyerBroker').addEventListener('change', function() {
                document.getElementById('buyerBrokerOtherGroup').style.display = 
                    this.value === 'other' ? 'block' : 'none';
            });

            document.getElementById('sellerBroker').addEventListener('change', function() {
                document.getElementById('sellerBrokerOtherGroup').style.display = 
                    this.value === 'other' ? 'block' : 'none';
            });

            // Settlement type change
            document.getElementById('settleType').addEventListener('change', function() {
                handleSettlementChange(this.value);
            });

            // Transaction date change
            document.getElementById('transactionDate').addEventListener('change', function() {
                calculateSettleDate();
            });

            // Form submission
            document.getElementById('transactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveTransaction();
            });

            // Search and filter history
            document.getElementById('searchHistory').addEventListener('input', filterHistory);
            document.getElementById('filterStatus').addEventListener('change', filterHistory);
        }

        // ==================== STOCK AUTOCOMPLETE FUNCTIONS ====================
        function createStockDropdown(rowNum) {
            return `
                <div class="stock-input-wrapper">
                    <input type="text" 
                           class="form-control stock-code-input" 
                           id="stockCode${rowNum}"
                           name="stockCode${rowNum}" 
                           placeholder="Ketik kode..."
                           autocomplete="off"
                           oninput="handleStockSearch(${rowNum}, this.value)"
                           onfocus="handleStockFocus(${rowNum})"
                           required>
                    <div class="stock-dropdown" id="stockDropdown${rowNum}">
                        <!-- Dropdown items will be populated here -->
                    </div>
                </div>
            `;
        }

        function handleStockSearch(rowNum, searchTerm) {
            const dropdown = document.getElementById(`stockDropdown${rowNum}`);
            const upperSearch = searchTerm.toUpperCase().trim();

            if (searchTerm.length < 1) {
                dropdown.classList.remove('show');
                return;
            }

            // Filter stocks
            const filteredStocks = uniqueStockDatabase.filter(stock => 
                stock.code.includes(upperSearch) || 
                stock.name.toUpperCase().includes(upperSearch)
            ).slice(0, 15); // Limit to 15 results

            if (filteredStocks.length === 0) {
                dropdown.innerHTML = '<div class="no-result">Saham tidak ditemukan</div>';
            } else {
                dropdown.innerHTML = filteredStocks.map((stock, index) => `
                    <div class="stock-dropdown-item" 
                         onclick="selectStock(${rowNum}, '${stock.code}', '${stock.name.replace(/'/g, "\\'")}')">
                        <span class="stock-code">${highlightMatch(stock.code, searchTerm)}</span>
                        <span class="stock-name">${highlightMatch(stock.name, searchTerm)}</span>
                        <span class="stock-sector">${stock.sector}</span>
                    </div>
                `).join('');
            }

            dropdown.classList.add('show');
            activeDropdown = rowNum;

            // Update input to uppercase
            document.getElementById(`stockCode${rowNum}`).value = upperSearch;
        }

        function handleStockFocus(rowNum) {
            const input = document.getElementById(`stockCode${rowNum}`);
            if (input.value.length >= 1) {
                handleStockSearch(rowNum, input.value);
            }
        }

        function highlightMatch(text, search) {
            if (!search) return text;
            const regex = new RegExp(`(${search})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        function selectStock(rowNum, code, name) {
            document.getElementById(`stockCode${rowNum}`).value = code;
            document.querySelector(`[name="stockName${rowNum}"]`).value = name;
            document.getElementById(`stockDropdown${rowNum}`).classList.remove('show');
            
            // Focus on quantity field
            document.querySelector(`[name="stockQty${rowNum}"]`).focus();
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.stock-dropdown').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
            activeDropdown = null;
        }

        // Keyboard navigation for dropdown
        document.addEventListener('keydown', function(e) {
            if (activeDropdown === null) return;

            const dropdown = document.getElementById(`stockDropdown${activeDropdown}`);
            const items = dropdown.querySelectorAll('.stock-dropdown-item');
            const selectedItem = dropdown.querySelector('.stock-dropdown-item.selected');
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (!selectedItem) {
                    items[0]?.classList.add('selected');
                } else {
                    const currentIndex = Array.from(items).indexOf(selectedItem);
                    selectedItem.classList.remove('selected');
                    items[(currentIndex + 1) % items.length]?.classList.add('selected');
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (!selectedItem) {
                    items[items.length - 1]?.classList.add('selected');
                } else {
                    const currentIndex = Array.from(items).indexOf(selectedItem);
                    selectedItem.classList.remove('selected');
                    items[(currentIndex - 1 + items.length) % items.length]?.classList.add('selected');
                }
            } else if (e.key === 'Enter' && selectedItem) {
                e.preventDefault();
                selectedItem.click();
            } else if (e.key === 'Escape') {
                closeAllDropdowns();
            }
        });

        // ==================== TAB FUNCTIONS ====================
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            if (tabId === 'preview') {
                updatePreview();
            }
        }

        // ==================== REFERENCE NUMBER ====================
        function generateReferenceNo() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            const refNo = `NEG-${year}${month}${day}-${random}`;
            document.getElementById('referenceNo').value = refNo;
        }

        // ==================== TRANSACTION TYPE ====================
        function selectTransactionType(type) {
            document.querySelectorAll('.type-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
            document.getElementById('transactionType').value = type;
        }

        // ==================== SETTLEMENT FUNCTIONS ====================
        function handleSettlementChange(value) {
            const customGroup = document.getElementById('customSettleGroup');
            customGroup.style.display = value === 'custom' ? 'block' : 'none';
            calculateSettleDate();
        }

        function calculateSettleDate() {
            const transDate = document.getElementById('transactionDate').value;
            const settleType = document.getElementById('settleType').value;
            
            if (!transDate || !settleType) return;

            let days = 0;
            if (settleType === 'custom') {
                const customSettle = document.getElementById('customSettle').value;
                const match = customSettle.match(/T\+(\d+)/i);
                days = match ? parseInt(match[1]) : 0;
            } else {
                const match = settleType.match(/T\+(\d+)/i);
                days = match ? parseInt(match[1]) : 0;
            }

            const date = new Date(transDate);
            date.setDate(date.getDate() + days);
            
            document.getElementById('settleDate').value = date.toISOString().split('T')[0];
        }

        // ==================== STOCK TABLE FUNCTIONS ====================
        function addStockRow() {
            stockRowCount++;
            const tbody = document.getElementById('stocksBody');
            const row = document.createElement('tr');
            row.id = `stockRow${stockRowCount}`;
            row.innerHTML = `
                <td>${stockRowCount}</td>
                <td>
                    ${createStockDropdown(stockRowCount)}
                </td>
                <td>
                    <input type="text" class="form-control" name="stockName${stockRowCount}" 
                           placeholder="Nama saham (auto)" readonly required
                           style="background: #f8f9fa;">
                </td>
                <td>
                    <input type="number" class="form-control" name="stockQty${stockRowCount}" 
                           placeholder="1000" min="1" required onchange="calculateRowTotal(${stockRowCount})"
                           oninput="calculateRowTotal(${stockRowCount})">
                </td>
                <td>
                    <input type="number" class="form-control" name="stockPrice${stockRowCount}" 
                           placeholder="9500" min="1" required onchange="calculateRowTotal(${stockRowCount})"
                           oninput="calculateRowTotal(${stockRowCount})">
                </td>
                <td>
                    <input type="text" class="form-control calculated-field" name="stockTotal${stockRowCount}" 
                           value="Rp 0" readonly>
                </td>
                <td>
                    <button type="button" class="btn btn-danger btn-icon" onclick="removeStockRow(${stockRowCount})" 
                            ${stockRowCount === 1 ? 'disabled' : ''} title="Hapus">
                        üóëÔ∏è
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        }

        function removeStockRow(rowNum) {
            const row = document.getElementById(`stockRow${rowNum}`);
            if (row) {
                row.remove();
                calculateGrandTotal();
                renumberRows();
            }
        }

        function renumberRows() {
            const rows = document.querySelectorAll('#stocksBody tr');
            rows.forEach((row, index) => {
                row.querySelector('td:first-child').textContent = index + 1;
            });
        }

        function calculateRowTotal(rowNum) {
            const qty = parseFloat(document.querySelector(`[name="stockQty${rowNum}"]`)?.value) || 0;
            const price = parseFloat(document.querySelector(`[name="stockPrice${rowNum}"]`)?.value) || 0;
            const total = qty * price;
            
            const totalField = document.querySelector(`[name="stockTotal${rowNum}"]`);
            if (totalField) {
                totalField.value = formatCurrency(total);
            }
            calculateGrandTotal();
        }

        function calculateGrandTotal() {
            let grandTotal = 0;
            document.querySelectorAll('#stocksBody tr').forEach(row => {
                const totalField = row.querySelector('[name^="stockTotal"]');
                if (totalField) {
                    const value = parseCurrency(totalField.value);
                    grandTotal += value;
                }
            });
            document.getElementById('grandTotal').value = formatCurrency(grandTotal);
        }

        // ==================== FORMAT FUNCTIONS ====================
        function formatCurrency(value) {
            return 'Rp ' + new Intl.NumberFormat('id-ID').format(value);
        }

        function parseCurrency(str) {
            return parseFloat(str.replace(/[^\d]/g, '')) || 0;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // ==================== PREVIEW FUNCTIONS ====================
        function previewDocument() {
            if (!validateForm()) return;
            updatePreview();
            switchTab('preview');
        }

        function updatePreview() {
            // Reference and Date
            document.getElementById('previewRefNo').textContent = document.getElementById('referenceNo').value;
            document.getElementById('previewDate').textContent = formatDate(document.getElementById('transactionDate').value);

            // Buyer Info
            document.getElementById('previewBuyerId').textContent = document.getElementById('buyerClientId').value || '-';
            document.getElementById('previewBuyerName').textContent = document.getElementById('buyerName').value || '-';
            const buyerBroker = document.getElementById('buyerBroker').value === 'other' 
                ? document.getElementById('buyerBrokerOther').value 
                : document.getElementById('buyerBroker').value;
            document.getElementById('previewBuyerBroker').textContent = buyerBroker || '-';

            // Seller Info
            document.getElementById('previewSellerId').textContent = document.getElementById('sellerClientId').value || '-';
            document.getElementById('previewSellerName').textContent = document.getElementById('sellerName').value || '-';
            const sellerBroker = document.getElementById('sellerBroker').value === 'other' 
                ? document.getElementById('sellerBrokerOther').value 
                : document.getElementById('sellerBroker').value;
            document.getElementById('previewSellerBroker').textContent = sellerBroker || '-';

            // Transaction Info
            document.getElementById('previewTransDate').textContent = formatDate(document.getElementById('transactionDate').value);
            document.getElementById('previewTransType').textContent = document.getElementById('transactionType').value || '-';
            
            const settleType = document.getElementById('settleType').value === 'custom'
                ? document.getElementById('customSettle').value
                : document.getElementById('settleType').value;
            document.getElementById('previewSettleType').textContent = settleType || '-';
            document.getElementById('previewSettleDate').textContent = formatDate(document.getElementById('settleDate').value);

            // Stocks Table
            const previewBody = document.getElementById('previewStocksBody');
            previewBody.innerHTML = '';
            let rowNum = 0;
            
            document.querySelectorAll('#stocksBody tr').forEach(row => {
                rowNum++;
                const codeInput = row.querySelector('[name^="stockCode"]');
                const code = codeInput ? codeInput.value : '';
                const name = row.querySelector('[name^="stockName"]').value;
                const qty = row.querySelector('[name^="stockQty"]').value;
                const price = row.querySelector('[name^="stockPrice"]').value;
                const total = row.querySelector('[name^="stockTotal"]').value;
                
                const previewRow = document.createElement('tr');
                previewRow.innerHTML = `
                    <td>${rowNum}</td>
                    <td><strong>${code}</strong></td>
                    <td>${name}</td>
                    <td>${new Intl.NumberFormat('id-ID').format(qty)}</td>
                    <td>${formatCurrency(price)}</td>
                    <td><strong>${total}</strong></td>
                `;
                previewBody.appendChild(previewRow);
            });

            // Total
            const grandTotal = document.getElementById('grandTotal').value;
            document.getElementById('previewTotal').textContent = grandTotal;
            document.getElementById('previewTotalBig').textContent = grandTotal;

            // Signature names
            document.getElementById('signBuyerName').textContent = document.getElementById('buyerName').value || '________________';
            document.getElementById('signSellerName').textContent = document.getElementById('sellerName').value || '________________';
        }

        // ==================== VALIDATION ====================
        function validateForm() {
            const requiredFields = [
                'buyerClientId', 'buyerName', 'buyerBroker',
                'sellerClientId', 'sellerName', 'sellerBroker',
                'transactionDate', 'settleType'
            ];

            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value || field.value === '') {
                    showAlert('Mohon lengkapi semua field yang wajib diisi!', 'error');
                    field.focus();
                    return false;
                }
            }

            // Check if at least one stock is added
            const stockRows = document.querySelectorAll('#stocksBody tr');
            if (stockRows.length === 0) {
                showAlert('Tambahkan minimal satu saham!', 'error');
                return false;
            }

            // Validate stock rows
            for (const row of stockRows) {
                const codeInput = row.querySelector('[name^="stockCode"]');
                const code = codeInput ? codeInput.value : '';
                const name = row.querySelector('[name^="stockName"]').value;
                const qty = row.querySelector('[name^="stockQty"]').value;
                const price = row.querySelector('[name^="stockPrice"]').value;

                if (!code || !name || !qty || !price) {
                    showAlert('Mohon lengkapi data saham!', 'error');
                    return false;
                }
            }

            return true;
        }

        // ==================== SAVE TRANSACTION ====================
        function saveTransaction() {
            if (!validateForm()) return;

            // Collect stock data
            const stocks = [];
            document.querySelectorAll('#stocksBody tr').forEach(row => {
                const codeInput = row.querySelector('[name^="stockCode"]');
                stocks.push({
                    code: codeInput ? codeInput.value : '',
                    name: row.querySelector('[name^="stockName"]').value,
                    qty: parseInt(row.querySelector('[name^="stockQty"]').value),
                    price: parseFloat(row.querySelector('[name^="stockPrice"]').value),
                    total: parseCurrency(row.querySelector('[name^="stockTotal"]').value)
                });
            });

            const buyerBroker = document.getElementById('buyerBroker').value === 'other' 
                ? document.getElementById('buyerBrokerOther').value 
                : document.getElementById('buyerBroker').value;

            const sellerBroker = document.getElementById('sellerBroker').value === 'other' 
                ? document.getElementById('sellerBrokerOther').value 
                : document.getElementById('sellerBroker').value;

            const settleType = document.getElementById('settleType').value === 'custom'
                ? document.getElementById('customSettle').value
                : document.getElementById('settleType').value;

            const transaction = {
                id: Date.now(),
                referenceNo: document.getElementById('referenceNo').value,
                transactionDate: document.getElementById('transactionDate').value,
                transactionType: document.getElementById('transactionType').value,
                settleType: settleType,
                settleDate: document.getElementById('settleDate').value,
                buyer: {
                    clientId: document.getElementById('buyerClientId').value,
                    name: document.getElementById('buyerName').value,
                    broker: buyerBroker
                },
                seller: {
                    clientId: document.getElementById('sellerClientId').value,
                    name: document.getElementById('sellerName').value,
                    broker: sellerBroker
                },
                stocks: stocks,
                grandTotal: parseCurrency(document.getElementById('grandTotal').value),
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            transactions.push(transaction);
            localStorage.setItem('stockTransactions', JSON.stringify(transactions));
            
            showAlert('Transaksi berhasil disimpan!', 'success');
            resetForm();
            loadHistory();
        }

        // ==================== HISTORY FUNCTIONS ====================
        function loadHistory() {
            const tbody = document.getElementById('historyBody');
            const table = document.getElementById('historyTable');
            const empty = document.getElementById('emptyHistory');

            tbody.innerHTML = '';

            if (transactions.length === 0) {
                table.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            empty.style.display = 'none';

            transactions.slice().reverse().forEach(trans => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${trans.referenceNo}</strong></td>
                    <td>${formatDate(trans.transactionDate)}</td>
                    <td>${trans.buyer.name}<br><small style="color: #666">${trans.buyer.broker}</small></td>
                    <td>${trans.seller.name}<br><small style="color: #666">${trans.seller.broker}</small></td>
                    <td><strong>${formatCurrency(trans.grandTotal)}</strong></td>
                    <td>
                        <select class="form-control" style="padding: 5px 10px; font-size: 0.85rem;" 
                                onchange="updateStatus(${trans.id}, this.value)">
                            <option value="pending" ${trans.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="completed" ${trans.status === 'completed' ? 'selected' : ''}>Completed</option>
                            <option value="cancelled" ${trans.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="viewDetail(${trans.id})" style="margin-bottom: 5px;">
                            üëÅÔ∏è
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTransaction(${trans.id})">
                            üóëÔ∏è
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterHistory() {
            const search = document.getElementById('searchHistory').value.toLowerCase();
            const status = document.getElementById('filterStatus').value;
            
            const rows = document.querySelectorAll('#historyBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const rowStatus = row.querySelector('select').value;
                
                const matchSearch = text.includes(search);
                const matchStatus = !status || rowStatus === status;
                
                row.style.display = matchSearch && matchStatus ? '' : 'none';
            });
        }

        function updateStatus(id, status) {
            const index = transactions.findIndex(t => t.id === id);
            if (index !== -1) {
                transactions[index].status = status;
                localStorage.setItem('stockTransactions', JSON.stringify(transactions));
                showAlert('Status berhasil diperbarui!', 'success');
            }
        }

        function deleteTransaction(id) {
            if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('stockTransactions', JSON.stringify(transactions));
                loadHistory();
                showAlert('Transaksi berhasil dihapus!', 'success');
            }
        }

        function clearAllHistory() {
            if (confirm('Apakah Anda yakin ingin menghapus SEMUA riwayat transaksi?')) {
                transactions = [];
                localStorage.removeItem('stockTransactions');
                loadHistory();
                showAlert('Semua riwayat berhasil dihapus!', 'success');
            }
        }

        function viewDetail(id) {
            const trans = transactions.find(t => t.id === id);
            if (!trans) return;

            let stocksHtml = '';
            trans.stocks.forEach((stock, index) => {
                stocksHtml += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${stock.code}</strong></td>
                        <td>${stock.name}</td>
                        <td>${new Intl.NumberFormat('id-ID').format(stock.qty)}</td>
                        <td>${formatCurrency(stock.price)}</td>
                        <td><strong>${formatCurrency(stock.total)}</strong></td>
                    </tr>
                `;
            });

            document.getElementById('modalContent').innerHTML = `
                <div class="preview-header" style="border-bottom: 2px solid #1a5276; margin-bottom: 20px;">
                    <h2 style="font-size: 1.5rem;">KESEPAKATAN JUAL BELI SAHAM</h2>
                    <p>No: ${trans.referenceNo}</p>
                </div>

                <div class="preview-grid">
                    <div class="preview-section buyer">
                        <h4>üõí PEMBELI</h4>
                        <div class="preview-item"><span class="label">Client ID</span><span class="value">${trans.buyer.clientId}</span></div>
                        <div class="preview-item"><span class="label">Nama</span><span class="value">${trans.buyer.name}</span></div>
                        <div class="preview-item"><span class="label">Broker</span><span class="value">${trans.buyer.broker}</span></div>
                    </div>
                    <div class="preview-section seller">
                        <h4>üí∞ PENJUAL</h4>
                        <div class="preview-item"><span class="label">Client ID</span><span class="value">${trans.seller.clientId}</span></div>
                        <div class="preview-item"><span class="label">Nama</span><span class="value">${trans.seller.name}</span></div>
                        <div class="preview-item"><span class="label">Broker</span><span class="value">${trans.seller.broker}</span></div>
                    </div>
                </div>

                <div class="preview-section" style="background: #fff3cd; margin: 20px 0;">
                    <h4>üìä DETAIL TRANSAKSI</h4>
                    <div class="preview-grid">
                        <div class="preview-item"><span class="label">Tanggal</span><span class="value">${formatDate(trans.transactionDate)}</span></div>
                        <div class="preview-item"><span class="label">Tipe</span><span class="value">${trans.transactionType}</span></div>
                        <div class="preview-item"><span class="label">Settlement</span><span class="value">${trans.settleType}</span></div>
                        <div class="preview-item"><span class="label">Tgl Settlement</span><span class="value">${formatDate(trans.settleDate)}</span></div>
                    </div>
                </div>

                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Kode</th>
                            <th>Nama Saham</th>
                            <th>Jumlah</th>
                            <th>Harga</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>${stocksHtml}</tbody>
                    <tfoot>
                        <tr>
                            <td colspan="5" style="text-align: right; font-weight: bold;">TOTAL</td>
                            <td style="font-weight: bold;">${formatCurrency(trans.grandTotal)}</td>
                        </tr>
                    </tfoot>
                </table>
            `;

            document.getElementById('detailModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function printModalContent() {
            const content = document.getElementById('modalContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Cetak Transaksi</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .preview-header { text-align: center; margin-bottom: 30px; }
                        .preview-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
                        .preview-section { padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                        .preview-section.buyer { background: #d4edda; }
                        .preview-section.seller { background: #f8d7da; }
                        .preview-section h4 { margin-bottom: 10px; }
                        .preview-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #ddd; }
                        .preview-item:last-child { border-bottom: none; }
                        .preview-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        .preview-table th, .preview-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        .preview-table th { background: #1a5276; color: white; }
                        .preview-table tfoot { background: #fff3cd; }
                    </style>
                </head>
                <body>${content}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // ==================== UTILITY FUNCTIONS ====================
        function resetForm() {
            document.getElementById('transactionForm').reset();
            document.getElementById('stocksBody').innerHTML = '';
            stockRowCount = 0;
            addStockRow();
            generateReferenceNo();
            document.getElementById('transactionDate').valueAsDate = new Date();
            selectTransactionType('DVP');
            document.getElementById('buyerBrokerOtherGroup').style.display = 'none';
            document.getElementById('sellerBrokerOtherGroup').style.display = 'none';
            document.getElementById('customSettleGroup').style.display = 'none';
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}
                ${message}
            `;
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        function printDocument() {
            window.print();
        }

        function exportPDF() {
            showAlert('Fitur export PDF memerlukan library tambahan. Untuk sementara, gunakan fitur Print dan simpan sebagai PDF.', 'warning');
            setTimeout(() => {
                window.print();
            }, 1000);
        }

        // Close modal when clicking outside
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>

</body></html>